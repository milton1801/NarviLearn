<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Log In Narvi</title>
  <link rel="stylesheet" href="log.css">
  <script src="scrip.js" defer></script> 
  <script src="global.js"></script>
  <link rel="stylesheet" href="global.css">
</head>
<body>
  <a href="index.html"><h2>NarviLearn</h2></a>

  <p id="p1">Welcome back</p>
  
  <ul id="list2">
    <!-- Email -->
    <li>
      <input type="text" placeholder="Email" id="in1">
      <a id="edit" href="#">Edit</a>
    </li>
    <p id="erro1"> ! Please enter your email address</p>
    <p id="erro2"> ! Enter a valid email</p>
    <!-- Password -->
    <li>
      <a href="#" id="hide">
        <input type="text" placeholder="Password" id="in2">
        <svg xmlns="http://www.w3.org/2000/svg" height="22px" viewBox="0 -960 960 960" width="21px" fill="#e3e3e3">
          <path d="M480-320q75 0 127.5-52.5T660-500q0-75-52.5-127.5T480-680q-75 0-127.5 52.5T300-500q0 75 52.5 127.5T480-320Zm0-72q-45 0-76.5-31.5T372-500q0-45 31.5-76.5T480-608q45 0 76.5 31.5T588-500q0 45-31.5 76.5T480-392Zm0 192q-146 0-266-81.5T40-500q54-137 174-218.5T480-800q146 0 266 81.5T920-500q-54 137-174 218.5T480-200Zm0-300Zm0 220q113 0 207.5-59.5T832-500q-50-101-144.5-160.5T480-720q-113 0-207.5 59.5T128-500q50 101 144.5 160.5T480-280Z"/>
        </svg>
      </a>
    </li>
    <p id="erro3"> ! Please enter your password</p>
    <p id="erro4"> ! Incorrect Password, Please try again</p>
    <!-- Log In Button -->
    <li id="log">
      <a href="Home.html"><button id="loginBtn">Log In</button></a>
    </li>
  </ul>

  <p id="do">
    Don't have an account? <a href="signUp.html">Sign Up</a>
  </p>
  <p id="o">-or-</p>

  <!-- Google Sign-In -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <div id="g_id_onload"
       data-client_id="403538978523-r0ibp76pk8qpbieacj0ah2k7roqf1frc.apps.googleusercontent.com"
       data-callback="handleCredentialResponse">
  </div>
  <div class="g_id_signin" data-type="standard"></div>

  <!-- Loading Spinner (Hidden) -->
  <div id="loadingSpinner" style="display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);font-size:24px;">
    Loading...
  </div>



  <!-- Firebase -->
  
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDPy6wUxciHk2fAeFmZ9pPtL5sNwwA7gwc",
      authDomain: "learnnarvi1.firebaseapp.com",
      projectId: "learnnarvi1",
      storageBucket: "learnnarvi1.firebasestorage.app",
      messagingSenderId: "540019310652",
      appId: "1:540019310652:web:2a8a0ac2b5b8fe30e6c339",
      measurementId: "G-25RWM41ZWF"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    // ✅ CORRECT Google Sign-In Handler
    function handleCredentialResponse(response) {
      console.log("Google ID Token:", response.credential);

      if (!response.credential) {
        console.error("No credential received");
        alert("Sign-in failed. No credential.");
        return;
      }

      const credential = firebase.auth.GoogleAuthProvider.credential(response.credential);

      firebase.auth().signInWithCredential(credential)
        .then((userCredential) => {
          console.log("Firebase Sign-In Success:", userCredential.user);

          document.getElementById('loadingSpinner').style.display = 'block';

          setTimeout(() => {
            window.location.href = "Home.html";
          }, 1000);
        })
        .catch((error) => {
          console.error("Firebase Sign-In Error:", error.code, error.message);
          alert("Sign-in failed. Please try again.");
        });
    }

    // ✅ Email/Password login
    document.getElementById("loginBtn").addEventListener("click", function(e) {
      e.preventDefault();
      const email = document.getElementById("in1").value;
      const password = document.getElementById("in2").value;

      if (!email || !password) {
        alert("Please fill in both fields!");
        return;
      }

      auth.signInWithEmailAndPassword(email, password)
        .then((userCredential) => {
          console.log("User logged in:", userCredential.user);
          window.location.href = "Home.html";
        })
        .catch((error) => {
          console.error("Login error:", error.message);
          alert("Login failed: " + error.message);
        });
    });
  </script>

  <!-- Microsoft Sign-In -->
  <script type="text/javascript" src="https://alcdn.msauth.net/browser/2.38.0/js/msal-browser.min.js"></script>
  <script>
    const msalConfig = {
      auth: {
        clientId:'9fa44615-e495-44ce-8c03-a119fbdb4a5b', 
        redirectUri: "http://localhost:3000",
      }
    };

    const msalInstance = new msal.PublicClientApplication(msalConfig);

    function signIn() {
      msalInstance.loginPopup({
        scopes: ["user.read"]
      }).then(response => {
        console.log("Microsoft Login Success:", response);
        alert("Welcome, " + response.account.username + "!");
      }).catch(error => {
        console.error("Microsoft Login Error:", error);
      });
    }
  </script>

  <button onclick="signIn()" id="l2">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/44/Microsoft_logo.svg/2048px-Microsoft_logo.svg.png" alt="">
    Sign in with Microsoft
  </button>

</body>
</html>
